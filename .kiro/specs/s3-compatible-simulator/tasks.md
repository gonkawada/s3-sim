# 実装タスクリスト

- [x] 1. カスタム例外クラスの実装





  - `s3_simulator.py`にカスタム例外クラスを定義
  - `S3SimulatorError`（基底クラス）、`BucketNotFoundError`、`ObjectNotFoundError`、`SecurityError`、`FileTypeError`を実装
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 2. BucketManagerクラスの実装






  - [x] 2.1 BucketManagerクラスの基本構造を作成

    - `__init__`メソッドでバケット設定を初期化
    - バケット名とディレクトリパスのマッピングを`pathlib.Path`で管理
    - 起動時にバケットディレクトリの存在を検証
    - _要件: 1.3, 3.1, 3.2_
  - [x] 2.2 セキュリティチェック機能を実装

    - `_is_safe_path`メソッドでパストラバーサル攻撃を防止
    - `Path.resolve()`と`is_relative_to()`を使用してパス検証
    - _要件: 8.2_
  - [x] 2.3 ファイル取得機能を実装

    - `get_file`メソッドでバケットとキーからファイルを取得
    - PDFファイル（`.pdf`拡張子）のみ許可（大文字小文字を区別しない）
    - ファイルをバイナリモードで読み込み
    - 適切な例外を発生させる（バケット不存在、ファイル不存在、セキュリティ違反、ファイルタイプエラー）
    - _要件: 2.2, 3.3, 3.4, 4.2, 4.4_

- [x] 3. S3SimulatorHandlerクラスの実装




  - [x] 3.1 HTTPリクエストハンドラの基本構造を作成


    - `BaseHTTPRequestHandler`を継承
    - クラス変数として`bucket_manager`を保持
    - _要件: 1.4, 2.1_
  - [x] 3.2 パス解析機能を実装


    - `_parse_s3_path`メソッドで`/{bucket}/{key}`形式のパスを解析
    - `urllib.parse.unquote`でURLデコード
    - パス形式が不正な場合は`ValueError`を発生
    - _要件: 4.1, 4.3_
  - [x] 3.3 GETリクエスト処理を実装


    - `do_GET`メソッドでGETリクエストを処理
    - パスを解析してバケットとキーを取得
    - `BucketManager.get_file`を呼び出してファイルを取得
    - 成功時はファイルレスポンスを送信
    - 例外発生時はエラーレスポンスを送信
    - _要件: 2.1, 2.2, 4.2, 5.1, 6.1_
  - [x] 3.4 レスポンス送信機能を実装


    - `_send_file_response`メソッドでPDFファイルレスポンスを送信（HTTP 200、Content-Type: application/pdf）
    - `_send_error_response`メソッドでJSON形式のエラーレスポンスを送信
    - エラーコードとHTTPステータスのマッピング（NoSuchBucket: 404、NoSuchKey: 404、AccessDenied: 403、InvalidFileType: 403、InternalError: 500、InvalidRequest: 400）
    - _要件: 2.2, 2.3, 2.4, 8.1, 8.2, 8.3, 8.4_
  - [x] 3.5 ログ出力機能を実装


    - `log_message`メソッドをオーバーライドして標準出力にログを出力
    - タイムスタンプ、メソッド、パス、ステータスコードを含める
    - _要件: 5.3_

- [x] 4. メイン関数とサーバ起動の実装





  - [x] 4.1 コマンドライン引数解析を実装


    - `argparse`を使用して`--bucket`（複数指定可能）と`--port`オプションを定義
    - `--bucket`は`name=path`形式で受け取る
    - デフォルトポートは8000
    - _要件: 1.4, 7.1_
  - [x] 4.2 main関数を実装


    - コマンドライン引数を解析
    - バケット設定から`BucketManager`を初期化
    - `S3SimulatorHandler`に`bucket_manager`を設定
    - `HTTPServer`を起動
    - 起動メッセージを出力
    - _要件: 1.1, 1.2, 1.4, 5.4, 6.2_

- [x] 5. ドキュメントの作成





  - [x] 5.1 README.mdを作成


    - 概要セクション: シミュレーターの目的と機能説明
    - 要件セクション: Python 3.7以上、標準ライブラリのみ使用
    - セットアップセクション: バケットディレクトリの準備方法とディレクトリ構造例
    - 使用方法セクション: 起動コマンドとオプション説明
    - セキュリティ警告: 開発・テスト用途専用であることを明記
    - _要件: 7.1, 7.2_
  - [x] 5.2 curlテストセクションを追加


    - 基本的なダウンロードコマンド例
    - ネストされたパスのダウンロード例
    - ヘッダー確認コマンド例
    - エラーケースのテスト例
    - _要件: 5.2, 7.3_

  - [x] 5.3 Dify連携セクションを追加

    - HTTPノードの設定方法（Method、URL、Headers）
    - 変数の渡し方（bucket、file_path）
    - URL形式の例: `http://localhost:8000/{{bucket}}/{{file_path}}`
    - レスポンス処理方法
    - _要件: 6.3, 6.4, 7.4_
  - [x] 5.4 トラブルシューティングセクションを追加


    - よくあるエラーと解決方法
    - ポート使用中エラー
    - バケットディレクトリが見つからないエラー
    - ファイルが見つからないエラー
    - _要件: 7.1_

- [x] 6. テストバケットディレクトリの作成





  - テスト用のディレクトリ構造を作成（`test-bucket/`）
  - サンプルPDFファイルを配置（または配置手順を記載）
  - ネストされたディレクトリ構造を含める（`documents/`、`reports/2024/`など）
  - _要件: 3.4, 7.2_
